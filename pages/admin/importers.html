<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin â€¢ Importers</title>
    <link rel="stylesheet" href="../../css/base.css" />
    <link rel="stylesheet" href="../../css/layout.css" />
    <link rel="stylesheet" href="../../css/components.css" />
  </head>
  <body>
    <header id="site-header" class="site-header"></header>
    <main class="section">
      <div class="container">
        <h1>Manage Importers (UI only)</h1>
        <div class="grid" style="grid-template-columns: 1fr 0.9fr; gap: 1rem">
          <section class="card pad">
            <h3>List</h3>
            <div
              id="adminList"
              class="grid"
              style="
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
              "
            ></div>
            <button id="exportAdminCsv" class="btn ghost space-top">
              Export CSV
            </button>
          </section>
          <aside class="card pad">
            <h3>CSV Import</h3>
            <input type="file" id="csvFile" accept=".csv" />
            <p class="muted">Prototype preview only.</p>
            <pre
              id="csvPreview"
              class="soft pad round"
              style="overflow: auto; max-height: 240px"
            ></pre>
          </aside>
        </div>
      </div>
    </main>
    <footer id="site-footer" class="site-footer"></footer>
    <script src="../../js/dom.js"></script>
    <script src="../../js/vendors/papaparse.min.js"></script>
    <script src="../../js/app.js"></script>
    <script>
      (async function () {
        const data = await fetch("../../data/importers.json")
          .then((r) => r.json())
          .catch(() => []);
        const list = document.getElementById("adminList");
        list.innerHTML = data
          .map(
            (i) =>
              `<div class="card pad"><strong>${i.name}</strong><div class="muted">${i.country}</div></div>`
          )
          .join("");
        document
          .getElementById("exportAdminCsv")
          .addEventListener("click", () => {
            const csv = Papa.unparse(data);
            const blob = new Blob([csv], { type: "text/csv" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "importers-all.csv";
            a.click();
            URL.revokeObjectURL(url);
          });
        document.getElementById("csvFile").addEventListener("change", (e) => {
          const f = e.target.files?.[0];
          if (!f) return;
          Papa.parse(f, {
            header: true,
            complete: (res) => {
              document.getElementById("csvPreview").textContent =
                JSON.stringify(res.data.slice(0, 5), null, 2);
            },
          });
        });
      })();
    </script>
    <script src="../../js/ui/footer.js"></script>
    <script src="../../js/ui/cookie-consent.js"></script>
  </body>
</html>
